<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Horizon Bookings</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- <link rel="icon" href="favicon.ico" type="image/x-icon"> -->

    <style>
        /* --- ENHANCED THEME --- */
        :root {
            --primary-color: #6a11cb; /* Deep Purple */
            --secondary-color: #2575fc; /* Bright Blue */
            --accent-color: #8a4efc;   /* Lighter Purple */
            --light-bg: rgba(255, 255, 255, 0.95); /* Slightly transparent white for container */
            --dark-text: #212529;
            --grey-text: #5a6470;
            --input-border-color: rgba(0, 0, 0, 0.1);
            --input-focus-border: var(--accent-color);
            --input-focus-shadow: rgba(106, 17, 203, 0.15);
            --error-color: #d93025;
            --error-bg: rgba(248, 215, 218, 0.8); /* Slightly transparent error bg */
            --button-shadow: 0 6px 15px rgba(40, 116, 252, 0.2);
            --button-hover-shadow: 0 8px S20px rgba(106, 17, 203, 0.25);
            --container-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            --font-primary: 'Poppins', sans-serif;
            --transition-speed: 0.3s;
            --border-radius: 12px; /* Consistent border radius */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: var(--font-primary);
        }

        html {
             height: 100%;
        }

        body {
            /* Animated Gradient Background */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), #6a11cb, #2575fc);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;

            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            padding: 20px;
             -webkit-font-smoothing: antialiased;
             -moz-osx-font-smoothing: grayscale;
             overflow-x: hidden; /* Prevent horizontal scroll from animations */
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            width: 100%;
            max-width: 420px; /* Slightly wider */
            padding: 40px;
            background: var(--light-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--container-shadow);
            text-align: center;
            opacity: 0; /* Start hidden for animation */
            animation: fadeIn 0.7s ease-out 0.2s forwards; /* Delay fadeIn */
            position: relative; /* For pseudo-elements */
            overflow: hidden; /* Hide overflow for effects */

            /* Subtle Glassmorphism */
             backdrop-filter: blur(8px);
             -webkit-backdrop-filter: blur(8px);
             border: 1px solid rgba(255, 255, 255, 0.2);
        }
        /* Optional: Add subtle noise/texture */
        /* .container::before {
             content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
             background-image: url('data:image/svg+xml,...'); // SVG noise pattern
             opacity: 0.03; pointer-events: none; z-index: -1;
        } */


        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98) translateY(15px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .logo {
            width: 85px;
            height: auto;
            margin-bottom: 20px;
            filter: drop-shadow(0 1px 3px rgba(0,0,0,0.1));
        }

        h2#formTitle {
            margin-bottom: 10px;
            color: var(--dark-text);
            font-size: 1.9rem;
            font-weight: 600;
        }

        .subtitle { /* Added class for subtitle */
            margin-bottom: 35px; /* More space */
            color: var(--grey-text);
            font-size: 1rem;
            font-weight: 300; /* Lighter weight */
        }

        .input-group {
            margin-bottom: 22px;
            text-align: left;
            position: relative; /* Needed for icon */
        }

        /* Input Styling with decorative icons */
        .input-group input[type="text"],
        .input-group input[type="password"] {
            width: 100%;
            padding: 15px 18px 15px 45px; /* Add padding for icon */
            border: 1px solid var(--input-border-color);
            background-color: #fff; /* Solid white input */
            border-radius: var(--border-radius);
            font-size: 1rem;
            color: var(--dark-text);
            transition: border-color var(--transition-speed) ease-in-out, box-shadow var(--transition-speed) ease-in-out, background-color var(--transition-speed) ease;
            appearance: none;
            background-repeat: no-repeat;
            background-position: 15px center; /* Position icon */
            background-size: 18px 18px; /* Icon size */
        }
         /* Basic SVG Icons as Data URIs (Replace with your actual icons if preferred) */
         /* User Icon */
         input[name="username"] {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23adb5bd' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'%3E%3C/path%3E%3Ccircle cx='12' cy='7' r='4'%3E%3C/circle%3E%3C/svg%3E");
         }
         /* Lock Icon */
          input[name="password"] {
              background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23adb5bd' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='11' width='18' height='11' rx='2' ry='2'%3E%3C/rect%3E%3Cpath d='M7 11V7a5 5 0 0 1 10 0v4'%3E%3C/path%3E%3C/svg%3E");
          }


        input[type="text"]::placeholder,
        input[type="password"]::placeholder {
             color: var(--grey-text);
             opacity: 0.7;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            border-color: var(--input-focus-border);
            outline: none;
            box-shadow: 0 0 0 4px var(--input-focus-shadow);
            background-color: #fff;
        }

        /* Button Styling */
        button[type="submit"] {
            width: 100%;
            padding: 15px; /* Slightly more padding */
            border: none;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.8px; /* Increased spacing */
            text-transform: uppercase;
            cursor: pointer;
            border-radius: var(--border-radius);
            margin-top: 20px;
            transition: all var(--transition-speed) ease;
            box-shadow: var(--button-shadow);
            position: relative; /* For pseudo-element */
            overflow: hidden; /* For ripple */
        }
         /* Subtle background animation on hover */
        button[type="submit"]::before {
             content: ''; position: absolute; top: 0; left: -75%; width: 200%; height: 100%;
             background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
             transition: left var(--transition-speed) ease-out;
        }

        button[type="submit"]:hover {
            background: linear-gradient(135deg, #580ead 0%, #1c64d8 100%);
            transform: translateY(-3px); /* More lift */
            box-shadow: var(--button-hover-shadow);
        }
         button[type="submit"]:hover::before {
             left: 100%;
         }

        button[type="submit"]:active {
             transform: translateY(-1px); /* Slight press down */
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
         button[type="submit"]:disabled {
             opacity: 0.6;
             cursor: wait;
             background: var(--grey-text);
             box-shadow: none;
             transform: translateY(0);
         }

        /* Toggle Switch Styling */
        .switch {
            margin-top: 30px; /* More space */
            font-size: 0.9rem;
            color: var(--grey-text);
        }

        .switch a {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 600; /* Bold link */
             transition: color var(--transition-speed) ease;
             position: relative; /* For underline effect */
             padding-bottom: 2px;
        }
         /* Underline effect */
        .switch a::after {
             content: '';
             position: absolute;
             width: 0;
             height: 1.5px;
             background-color: var(--primary-color);
             bottom: 0;
             left: 50%;
             transform: translateX(-50%);
             transition: width var(--transition-speed) ease;
        }

        .switch a:hover {
            color: var(--primary-color);
        }
         .switch a:hover::after {
             width: 100%;
         }

        /* Error Message Styling */
        .error {
            color: var(--error-color);
            background-color: var(--error-bg);
            font-size: 0.875rem; /* Slightly smaller */
            font-weight: 500;
            margin-top: 18px;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(217, 48, 37, 0.3); /* Softer border */
            text-align: left;
            display: none;
            align-items: center;
            gap: 10px;
            opacity: 0; /* Start hidden for animation */
            transform: translateY(-5px);
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
        }
        .error:not(:empty) {
             display: flex;
             opacity: 1;
             transform: translateY(0);
             animation: errorShake 0.5s cubic-bezier(.36,.07,.19,.97);
        }
        .error:not(:empty)::before {
             content: "!"; /* Exclamation mark icon */
             font-weight: bold;
             font-size: 1.2em;
             line-height: 1;
             color: var(--error-color);
             flex-shrink: 0; /* Prevent icon from shrinking */
        }
        @keyframes errorShake { /* Refined shake */
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-3px); }
            40%, 60% { transform: translateX(3px); }
        }

    </style>
</head>
<body>

<div class="container">
    <img src="logo.png" class="logo" alt="Horizon Bookings Logo"> <!-- Ensure logo.png exists -->
    <h2 id="formTitle">Welcome Back</h2>
    <p class="subtitle">Sign in to access your bookings</p> <!-- Added specific class -->

    <!-- LOGIN FORM -->
    <form id="loginForm">
        <div class="input-group">
            <input type="text" id="login-username" name="username" placeholder="Username" required>
        </div>
        <div class="input-group">
            <input type="password" id="login-password" name="password" placeholder="Password" required>
        </div>
        <button type="submit">Login</button>
        <p class="error" id="loginError"></p>
    </form>

    <!-- REGISTER FORM (HIDDEN INITIALLY) -->
    <form id="registerForm" style="display: none;">
        <div class="input-group">
            <input type="text" id="register-username" name="username" placeholder="Username" required>
        </div>
        <div class="input-group">
            <input type="password" id="register-password" name="password" placeholder="Password" required>
        </div>
        <button type="submit">Create Account</button>
        <p class="error" id="registerError"></p>
    </form>

    <p class="switch">
        <span id="toggleText">Don't have an account?</span>
        <a href="#" id="toggleForm">Register now</a>
    </p>
</div>

<script>
    // --- Your Existing Working JavaScript ---
    // (No changes made to this block, it works with the HTML structure)
    document.addEventListener("DOMContentLoaded", function () {
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const toggleText = document.getElementById("toggleText");
        const toggleForm = document.getElementById("toggleForm");
        const formTitle = document.getElementById("formTitle");
        const subtitle = document.querySelector(".subtitle"); // Select subtitle if you want to change it too
        const loginErrorElement = document.getElementById("loginError");
        const registerErrorElement = document.getElementById("registerError");

        // Helper to display errors using new style
        function displayError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message || "An unknown error occurred.";
                // CSS handles visibility via :not(:empty)
            } else {
                console.error("Error element not found:", elementId);
                alert("Error: " + message);
            }
        }

        // Toggle between Login & Register forms
        toggleForm.addEventListener("click", function (event) {
            event.preventDefault();
            if(loginErrorElement) loginErrorElement.textContent = "";
            if(registerErrorElement) registerErrorElement.textContent = "";

            if (loginForm.style.display === "none") {
                loginForm.style.display = "block";
                registerForm.style.display = "none";
                formTitle.textContent = "Welcome Back";
                if(subtitle) subtitle.textContent = "Sign in to access your bookings";
                toggleText.textContent = "Don't have an account?";
                toggleForm.textContent = "Register now";
                loginForm.reset();
            } else {
                loginForm.style.display = "none";
                registerForm.style.display = "block";
                formTitle.textContent = "Create Your Account";
                if(subtitle) subtitle.textContent = "Get started in seconds";
                toggleText.textContent = "Already have an account?";
                toggleForm.textContent = "Sign in";
                 registerForm.reset();
            }
        });

        // Handle login
        if(loginForm) {
             const loginButton = loginForm.querySelector('button[type="submit"]');
            loginForm.addEventListener("submit", function (event) {
                event.preventDefault();
                let formData = new FormData(this);
                if(loginErrorElement) loginErrorElement.textContent = "";

                const username = formData.get('username')?.trim();
                const password = formData.get('password')?.trim();
                 if (!username || !password) {
                     displayError("loginError", "Username and Password are required.");
                     return;
                 }
                 if(loginButton) loginButton.disabled = true; // Disable button

                fetch("http://localhost:8081/auth/perform_login", { /* ... fetch options ... */
                    method: "POST",
                    headers: {"Content-Type": "application/x-www-form-urlencoded"},
                    body: new URLSearchParams(formData)
                })
                .then(response => { /* ... response handling ... */
                    if (!response.ok) {
                         return response.json().catch(() => ({ success: false, message: `Login failed (Status: ${response.status})` }))
                            .then(errData => { throw new Error(errData.message || `Login failed`); });
                    }
                    return response.json();
                 })
                .then(data => {
                    if (data.success && data.userId) {
                        const userId = data.userId;
                        const redirectUrl = `hotels.html?userId=${userId}`;
                        console.log("Redirecting to:", redirectUrl);
                        // Optional: Add visual feedback before redirect
                        if(loginButton) loginButton.textContent = "Success!";
                        setTimeout(() => { window.location.href = redirectUrl; }, 300); // Faster redirect

                    } else if (data.success && !data.userId) {
                         console.error("Login successful but userId missing:", data);
                         displayError("loginError", "Login ok but failed to get user details.");
                         if(loginButton) loginButton.disabled = false; // Re-enable if stuck
                    } else {
                         displayError("loginError", data.message || "Invalid credentials");
                          if(loginButton) loginButton.disabled = false; // Re-enable on failure
                    }
                })
                .catch(error => {
                    console.error("Login Error:", error);
                    displayError("loginError", error.message || "Cannot connect to server.");
                     if(loginButton) loginButton.disabled = false; // Re-enable on fetch error
                });
                 // Removed finally block to handle button re-enabling only on error paths
            });
        }


        // Handle register (Using JSON)
        if(registerForm) {
            const registerButton = registerForm.querySelector('button[type="submit"]');
            registerForm.addEventListener("submit", function (event) {
                event.preventDefault();
                let formData = new FormData(this);
                if(registerErrorElement) registerErrorElement.textContent = "";

                 const username = formData.get('username')?.trim();
                 const password = formData.get('password')?.trim();
                 if (!username || !password) {
                     displayError("registerError", "Username and Password are required.");
                     return;
                 }
                 // Add password validation if desired
                 if(registerButton) registerButton.disabled = true;

                 let formObject = {};
                 formData.forEach((value, key) => { formObject[key] = value });
                 let jsonPayload = JSON.stringify(formObject);

                 fetch("http://localhost:8081/auth/register", { /* ... fetch options ... */
                     method: "POST",
                     headers: { "Content-Type": "application/json" },
                     body: jsonPayload
                 })
                 .then(response => { /* ... response handling ... */
                     if (!response.ok) {
                         return response.json().catch(() => ({ success: false, message: `Registration failed (Status: ${response.status})` }))
                             .then(errData => { throw new Error(errData.message || `Registration failed`); });
                     }
                     return response.json();
                 })
                .then(data => {
                    if (data.success) {
                        alert("Registration Successful! Please login.");
                        if (toggleForm) toggleForm.click(); // Switch to login form
                    } else {
                         displayError("registerError", data.message || "Registration failed");
                    }
                })
                .catch(error => {
                    console.error("Registration Error:", error);
                     displayError("registerError", error.message || "Failed to connect to the backend.");
                })
                .finally(() => {
                     if(registerButton) registerButton.disabled = false; // Always re-enable register button
                 });
            });
        }
    });
</script>

</body>
</html>